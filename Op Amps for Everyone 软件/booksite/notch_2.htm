<HTML>
<HEAD>
<TITLE>Notch Filter Calculator</TITLE>
<SCRIPT language="JavaScript">
function calculate1()
{
   capseq = parseFloat(document.theForm.capseq.value);
   if (capseq == 24)
   {
      cap = new Array (1.0, 1.1, 1.2, 1.3, 1.5, 1.6, 1.8, 2.0, 2.2, 2.4, 2.7, 3.0, 3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5, 8.2, 9.1)
   }
   if (capseq == 12)
   {
      cap = new Array (1.0, 1.2, 1.5, 1.8, 2.2, 2.7, 3.3, 3.9, 4.7, 5.6, 6.8, 8.2)
   }
   if (capseq == 6)
   {
      cap = new Array (1.0, 1.5, 2.2, 3.3, 4.7, 6.8)
   }
   res = new Array (1, 1.02, 1.05, 1.07, 1.1, 1.13, 1.15, 1.18, 1.21, 1.24, 1.27, 1.3, 1.33, 1.37, 1.4, 1.43, 1.47, 1.5, 1.54, 1.58, 1.62, 1.65, 1.69, 1.74, 1.78, 1.82, 1.87, 1.91, 1.96, 2, 2.05, 2.1, 2.15, 2.21, 2.26, 2.32, 2.37, 2.43, 2.49, 2.55, 2.61, 2.67, 2.74, 2.8, 2.87, 2.94, 3.01, 3.09, 3.16, 3.24, 3.32, 3.4, 3.48, 3.57, 3.65, 3.74, 3.83, 3.92, 4.02, 4.12, 4.22, 4.32, 4.42, 4.53, 4.64, 4.75, 4.87, 4.99, 5.11, 5.23, 5.36, 5.49, 5.62, 5.76, 5.9, 6.04, 6.19, 6.34, 6.49, 6.65, 6.81, 6.98, 7.15, 7.32, 7.5, 7.68, 7.87, 8.06, 8.25, 8.45, 8.66, 8.87, 9.09, 9.31, 9.53, 9.76, 10, 10.2, 10.5, 10.7, 11, 11.3, 11.5, 11.8, 12.1, 12.4, 12.7, 13, 13.3, 13.7, 14, 14.3, 14.7, 15, 15.4, 15.8, 16.2, 16.5, 16.9, 17.4, 17.8, 18.2, 18.7, 19.1, 19.6, 20, 20.5, 21, 21.5, 22.1, 22.6, 23.2, 23.7, 24.3, 24.9, 25.5, 26.1, 26.7, 27.4, 28, 28.7, 29.4, 30.1, 30.9, 31.6, 32.4, 33.2, 34, 34.8, 35.7, 36.5, 37.4, 38.3, 39.2, 40.2, 41.2, 42.2, 43.2, 44.2, 45.3, 46.4, 47.5, 48.7, 49.9, 51.1, 52.3, 53.6, 54.9, 56.2, 57.6, 59, 60.4, 61.9, 63.4, 64.9, 66.5, 68.1, 69.8, 71.5, 73.2, 75, 76.8, 78.7, 80.6, 82.5, 84.5, 86.6, 88.7, 90.9, 93.1, 95.3, 97.6, 100, 102, 105, 107, 110, 113, 115, 118, 121, 124, 127, 130, 133, 137, 140, 143, 147, 150, 154, 158, 162, 165, 169, 174, 178, 182, 187, 191, 196, 200, 205, 210, 215, 221, 226, 232, 237, 243, 249, 255, 261, 267, 274, 280, 287, 294, 301, 309, 316, 324, 332, 340, 348, 357, 365, 374, 383, 392, 402, 412, 422, 432, 442, 453, 464, 475, 487, 499, 511, 523, 536, 549, 562, 576, 590, 604, 619, 634, 649, 665, 681, 698, 715, 732, 750, 768, 787, 806, 825, 845, 866, 887, 909, 931, 953, 976, 1000, 1020, 1050, 1070, 1100, 1130, 1150, 1180, 1210, 1240, 1270, 1300, 1330, 1370, 1400, 1430, 1470, 1500, 1540, 1580, 1620, 1650, 1690, 1740, 1780, 1820, 1870, 1910, 1960, 2000, 2050, 2100, 2150, 2210, 2260, 2320, 2370, 2430, 2490, 2550, 2610, 2670, 2740, 2800, 2870, 2940, 3010, 3090, 3160, 3240, 3320, 3400, 3480, 3570, 3650, 3740, 3830, 3920, 4020, 4120, 4220, 4320, 4420, 4530, 4640, 4750, 4870, 4990, 5110, 5230, 5360, 5490, 5620, 5760, 5900, 6040, 6190, 6340, 6490, 6650, 6810, 6980, 7150, 7320, 7500, 7680, 7870, 8060, 8250, 8450, 8660, 8870, 9090, 9310, 9530, 9760, 10000, 10200, 10500, 10700, 11000, 11300, 11500, 11800, 12100, 12400, 12700, 13000, 13300, 13700, 14000, 14300, 14700, 15000, 15400, 15800, 16200, 16500, 16900, 17400, 17800, 18200, 18700, 19100, 19600, 20000, 20500, 21000, 21500, 22100, 22600, 23200, 23700, 24300, 24900, 25500, 26100, 26700, 27400, 28000, 28700, 29400, 30100, 30900, 31600, 32400, 33200, 34000, 34800, 35700, 36500, 37400, 38300, 39200, 40200, 41200, 42200, 43200, 44200, 45300, 46400, 47500, 48700, 49900, 51100, 52300, 53600, 54900, 56200, 57600, 59000, 60400, 61900, 63400, 64900, 66500, 68100, 69800, 71500, 73200, 75000, 76800, 78700, 80600, 82500, 84500, 86600, 88700, 90900, 93100, 95300, 97600, 100000, 102000, 105000, 107000, 110000, 113000, 115000, 118000, 121000, 124000, 127000, 130000, 133000, 137000, 140000, 143000, 147000, 150000, 154000, 158000, 162000, 165000, 169000, 174000, 178000, 182000, 187000, 191000, 196000, 200000, 205000, 210000, 215000, 221000, 226000, 232000, 237000, 243000, 249000, 255000, 261000, 267000, 274000, 280000, 287000, 294000, 301000, 309000, 316000, 324000, 332000, 340000, 348000, 357000, 365000, 374000, 383000, 392000, 402000, 412000, 422000, 432000, 442000, 453000, 464000, 475000, 487000, 499000, 511000, 523000, 536000, 549000, 562000, 576000, 590000, 604000, 619000, 634000, 649000, 665000, 681000, 698000, 715000, 732000, 750000, 768000, 787000, 806000, 825000, 845000, 866000, 887000, 909000, 931000, 953000, 976000, 1000000);
   r_pot = new Array (1, 2, 2.5, 5, 10, 20, 25, 50, 100, 200, 250, 500, 1000, 2000, 2500, 5000, 10000, 20000, 25000, 50000, 100000, 200000, 250000, 500000, 1000000);
   c_res = 0
   r_res = 0
   min_diff = 1
   decade = 1
   seed_decade = 1
   freq = parseFloat(document.theForm.freq.value)
   freq_entered = freq
   q = parseFloat(document.theForm.q.value)
   seed = parseFloat(document.theForm.seed.value)
   if (freq >= 100000000)
   {
      alert ("Frequency must be < 100 MHz!")
   }
   else if (freq >= 10000000 && freq < 100000000)
   {
      freq = freq / 100000000
      decade = decade * 1000000000
   }
   else if (freq >= 1000000 && freq < 10000000)
   {
      freq = freq / 10000000
      decade = decade * 100000000
   }
   else if (freq >= 100000 && freq < 1000000)
   {
      freq = freq / 1000000
      decade = decade * 10000000
   }
   else if (freq >= 10000 && freq < 100000)
   {
      freq = freq / 100000
      decade = decade * 1000000
   }
   else if (freq >= 1000 && freq < 10000)
   {
      freq = freq / 10000
      decade = decade * 100000
   }
   else if (freq >= 100 && freq < 1000)
   {
      freq = freq / 1000
      decade = decade * 10000
   }
   else if (freq >= 10 && freq < 100)
   {
      freq = freq / 100
      decade = decade * 1000
   }
   else if (freq >= 1 && freq < 10)
   {
      freq = freq / 10
      decade = decade * 100
   }
   else if (freq >= .1 && freq < 1)
   {
      decade = decade * 10
   }
   else if (freq >= .01 && freq < .1)
   {
      freq = freq * 10
      decade = decade * 1
   }
   else if (freq >= .001 && freq < .01)
   {
      freq = freq * 100
      decade = decade * .1
   }
   else alert("Frequency must be >= .001")
   for (i = 0 ; i < res.length ; i ++ )
   {
      for (j = 0 ; j < cap.length ; j ++ )
      {
         res_freq = 1 / (2 * Math.PI * res[i] * cap[j])
         if (res_freq < .01) res_freq = res_freq * 10
         if (res_freq < .1)  res_freq = res_freq * 10
         diff = Math.abs(freq - res_freq)
         if (diff <= min_diff)
         {
            min_diff = diff
            c_res = cap[j]
            r_res = res[i]
            r_low = res[i - 1]
            r_high = res[i + 1]
         }
      }

      real_freq = 1 / (2 * Math.PI * c_res * r_res / decade)
      if (freq_entered / real_freq > 90) decade = decade * 100
      if (freq_entered / real_freq > 9) decade = decade * 10
      if (real_freq / freq_entered > 9) decade = decade * .1
      decadeseed = (decade * seed) / 1000000000000
      document.theForm.c0.value = c_res / decadeseed
      document.theForm.r0.value = r_res * seed
      document.theForm.r0_low.value = r_low * seed
      r_range = (r_high - r_low) * seed
   }
   r0_adj = 1000000
   for (k = 0 ; k < r_pot.length ; k ++ )
   {
      if (r_range >= r_pot[k] && r_range <= r_pot[k + 1])
      {
         r0_adj = r_pot[k]
      }
      document.theForm.r0_adj.value = r0_adj
   }
   q_factor = q * 2
   rq2 = (r_res * seed * q_factor)
   for (k = 0 ; k < res.length ; k ++ )
   {
      if (rq2 >= res[k] && rq2 <= res[k + 1])
      {
         rq2_low = res[k]
         rq2_high = res[k + 1]
      }
   }
   rq2_high_diff = rq2_high - rq2
   rq2_low_diff = rq2 - rq2_low
   if (rq2_low_diff < rq2_high_diff)
   {
      rq2_final = rq2_low
   }
   else
   {
      rq2_final = rq2_high
   }
   document.theForm.rq2_final.value = rq2_final
}
</SCRIPT>
</HEAD>
<BODY bgcolor="White">
<FONT face="arial">
<h1>Notch Filter Calculator</h1>
<FORM name="theForm">
<table border="0"><td><tr>
<TABLE cellspacing="0" cellpadding="3" border="0" bgcolor="#ccffff">
<TR>
   <TD align="right"><B>Center Frequency (Hz): </B></TD>
   <TD><INPUT name="freq" value="10000" size = "7"></TD>
</TR>
<TR>
   <TD align="right"><B>Q: </B></TD>
   <TD><INPUT name="q" value="10" size = "7"></TD>
</TR>
<TR>
  <TD align="right"><B>Capacitor Sequence: </B></TD>
  <TD>
  <SELECT name="capseq">
     <OPTION value="24">E24</OPTION>
     <OPTION value="12">E12</OPTION>
     <OPTION value="6">E6</OPTION>
     </SELECT>
  </TD>
</TR>
<TR>
  <TD align="right"><B>Resistor Scale (Ohms): </B></TD>
  <TD>
  <SELECT name="seed">
     <OPTION value="1">1</OPTION>
     <OPTION value="10">10</OPTION>
     <OPTION value="100">100</OPTION>
     <OPTION selected="" value="1000">1000</OPTION>
     <OPTION value="10000">10000</OPTION>
     <OPTION value="100000">100000</OPTION>
     <OPTION value="1000000">1000000</OPTION>
  </SELECT>
  </TD>
</TR>
<TR>
   <TD>&nbsp;</TD>
   <TD><INPUT type="button" value="Calculate" onclick="calculate1()"></TD>
</TR>
<TR>
   <TD align="right"><B>Co (pF): </B></TD>
   <TD><INPUT name="c0" style="background: #ccffff; border=0" size = "7"></TD>
   <TD align="right"><B>Ro (Ohms): </B></TD>
   <TD><INPUT name="r0" style="background: #ccffff; border=0" size = "7"></TD>
</TR>
<TR>
   <TD align="right"><B>Ro_low (Ohms): </B></TD>
   <TD><INPUT name="r0_low" style="background: #ccffff; border=0" size = "7"></TD>
   <TD align="right"><B>Ro_adj (Ohms): </B></TD>
   <TD><INPUT name="r0_adj" style="background: #ccffff; border=0" size = "7"></TD>
</TR>
<TR>
   <TD align="right"><B>Rq (Ohms): </B></TD>
   <TD><INPUT name="rq2_final" style="background: #ccffff; border=0" size = "7"></TD>
</TR>
</TABLE>
</td><td>
<img src="notch_sch.gif" tppabs="http://booksite.elsevier.com/9780123914958/content/Notch_Filter_Calculator/notch_sch.gif">
</td></tr></table>
</FORM>
<p>The filter topology here is the Fliege topology.  I have found this to be the most stable and most easily tuned notch filter topology. 
<p>Tuning is done by varying Ro _adj.  If you do not want the adjustment capability, make Ro_low + Ro_adj = Ro.
<p>The Q setting is preset to 10.  This has little meaning for the depth of the notch, which is theoretically infinite.  It is primarly a measure of how much you will disturb the frequencies around the center.   Q's of 100 start eroding the notch depth, tuning becomes difficult, and the bandwidth of the op amp comes into play.  So 10 is a really good value - stick with it unless you really know what you are doing.</p>

</FONT>
</BODY>
</HTML>
