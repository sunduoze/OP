<HTML>
<HEAD>
<TITLE>Band Pass Filter Calculator With Adjustable Q and Gain</TITLE>
<SCRIPT language="JavaScript">
function calculate1()
{
   capseq = parseFloat(document.theForm.capseq.value);
   resseq = parseFloat(document.theForm.resseq.value);
   if (capseq == 24)
   {
      cap = new Array (1.0, 1.1, 1.2, 1.3, 1.5, 1.6, 1.8, 2.0, 2.2, 2.4, 2.7, 3.0, 3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5, 8.2, 9.1)
   }
   if (capseq == 12)
   {
      cap = new Array (1.0, 1.2, 1.5, 1.8, 2.2, 2.7, 3.3, 3.9, 4.7, 5.6, 6.8, 8.2)
   }
   if (capseq == 6)
   {
      cap = new Array (1.0, 1.5, 2.2, 3.3, 4.7, 6.8)
   }
   if (resseq == 96)
   {
      res = new Array (1, 1.02, 1.05, 1.07, 1.1, 1.13, 1.15, 1.18, 1.21, 1.24, 1.27, 1.3, 1.33, 1.37, 1.4, 1.43, 1.47, 1.5, 1.54, 1.58, 1.62, 1.65, 1.69, 1.74, 1.78, 1.82, 1.87, 1.91, 1.96, 2, 2.05, 2.1, 2.15, 2.21, 2.26, 2.32, 2.37, 2.43, 2.49, 2.55, 2.61, 2.67, 2.74, 2.8, 2.87, 2.94, 3.01, 3.09, 3.16, 3.24, 3.32, 3.4, 3.48, 3.57, 3.65, 3.74, 3.83, 3.92, 4.02, 4.12, 4.22, 4.32, 4.42, 4.53, 4.64, 4.75, 4.87, 4.99, 5.11, 5.23, 5.36, 5.49, 5.62, 5.76, 5.9, 6.04, 6.19, 6.34, 6.49, 6.65, 6.81, 6.98, 7.15, 7.32, 7.5, 7.68, 7.87, 8.06, 8.25, 8.45, 8.66, 8.87, 9.09, 9.31, 9.53, 9.76)
   }
   if (resseq == 24)
   {
      res = new Array (1.0, 1.1, 1.2, 1.3, 1.5, 1.6, 1.8, 2.0, 2.2, 2.4, 2.7, 3.0, 3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5, 8.2, 9.1);
   }
   clear1()
   rq = new Array (1, 1.02, 1.05, 1.07, 1.1, 1.13, 1.15, 1.18, 1.21, 1.24, 1.27, 1.3, 1.33, 1.37, 1.4, 1.43, 1.47, 1.5, 1.54, 1.58, 1.62, 1.65, 1.69, 1.74, 1.78, 1.82, 1.87, 1.91, 1.96, 2, 2.05, 2.1, 2.15, 2.21, 2.26, 2.32, 2.37, 2.43, 2.49, 2.55, 2.61, 2.67, 2.74, 2.8, 2.87, 2.94, 3.01, 3.09, 3.16, 3.24, 3.32, 3.4, 3.48, 3.57, 3.65, 3.74, 3.83, 3.92, 4.02, 4.12, 4.22, 4.32, 4.42, 4.53, 4.64, 4.75, 4.87, 4.99, 5.11, 5.23, 5.36, 5.49, 5.62, 5.76, 5.9, 6.04, 6.19, 6.34, 6.49, 6.65, 6.81, 6.98, 7.15, 7.32, 7.5, 7.68, 7.87, 8.06, 8.25, 8.45, 8.66, 8.87, 9.09, 9.31, 9.53, 9.76, 10, 10.2, 10.5, 10.7, 11, 11.3, 11.5, 11.8, 12.1, 12.4, 12.7, 13, 13.3, 13.7, 14, 14.3, 14.7, 15, 15.4, 15.8, 16.2, 16.5, 16.9, 17.4, 17.8, 18.2, 18.7, 19.1, 19.6, 20, 20.5, 21, 21.5, 22.1, 22.6, 23.2, 23.7, 24.3, 24.9, 25.5, 26.1, 26.7, 27.4, 28, 28.7, 29.4, 30.1, 30.9, 31.6, 32.4, 33.2, 34, 34.8, 35.7, 36.5, 37.4, 38.3, 39.2, 40.2, 41.2, 42.2, 43.2, 44.2, 45.3, 46.4, 47.5, 48.7, 49.9, 51.1, 52.3, 53.6, 54.9, 56.2, 57.6, 59, 60.4, 61.9, 63.4, 64.9, 66.5, 68.1, 69.8, 71.5, 73.2, 75, 76.8, 78.7, 80.6, 82.5, 84.5, 86.6, 88.7, 90.9, 93.1, 95.3, 97.6, 100, 102, 105, 107, 110, 113, 115, 118, 121, 124, 127, 130, 133, 137, 140, 143, 147, 150, 154, 158, 162, 165, 169, 174, 178, 182, 187, 191, 196, 200, 205, 210, 215, 221, 226, 232, 237, 243, 249, 255, 261, 267, 274, 280, 287, 294, 301, 309, 316, 324, 332, 340, 348, 357, 365, 374, 383, 392, 402, 412, 422, 432, 442, 453, 464, 475, 487, 499, 511, 523, 536, 549, 562, 576, 590, 604, 619, 634, 649, 665, 681, 698, 715, 732, 750, 768, 787, 806, 825, 845, 866, 887, 909, 931, 953, 976, 1000, 1020, 1050, 1070, 1100, 1130, 1150, 1180, 1210, 1240, 1270, 1300, 1330, 1370, 1400, 1430, 1470, 1500, 1540, 1580, 1620, 1650, 1690, 1740, 1780, 1820, 1870, 1910, 1960, 2000, 2050, 2100, 2150, 2210, 2260, 2320, 2370, 2430, 2490, 2550, 2610, 2670, 2740, 2800, 2870, 2940, 3010, 3090, 3160, 3240, 3320, 3400, 3480, 3570, 3650, 3740, 3830, 3920, 4020, 4120, 4220, 4320, 4420, 4530, 4640, 4750, 4870, 4990, 5110, 5230, 5360, 5490, 5620, 5760, 5900, 6040, 6190, 6340, 6490, 6650, 6810, 6980, 7150, 7320, 7500, 7680, 7870, 8060, 8250, 8450, 8660, 8870, 9090, 9310, 9530, 9760, 10000, 10200, 10500, 10700, 11000, 11300, 11500, 11800, 12100, 12400, 12700, 13000, 13300, 13700, 14000, 14300, 14700, 15000, 15400, 15800, 16200, 16500, 16900, 17400, 17800, 18200, 18700, 19100, 19600, 20000, 20500, 21000, 21500, 22100, 22600, 23200, 23700, 24300, 24900, 25500, 26100, 26700, 27400, 28000, 28700, 29400, 30100, 30900, 31600, 32400, 33200, 34000, 34800, 35700, 36500, 37400, 38300, 39200, 40200, 41200, 42200, 43200, 44200, 45300, 46400, 47500, 48700, 49900, 51100, 52300, 53600, 54900, 56200, 57600, 59000, 60400, 61900, 63400, 64900, 66500, 68100, 69800, 71500, 73200, 75000, 76800, 78700, 80600, 82500, 84500, 86600, 88700, 90900, 93100, 95300, 97600, 100000, 102000, 105000, 107000, 110000, 113000, 115000, 118000, 121000, 124000, 127000, 130000, 133000, 137000, 140000, 143000, 147000, 150000, 154000, 158000, 162000, 165000, 169000, 174000, 178000, 182000, 187000, 191000, 196000, 200000, 205000, 210000, 215000, 221000, 226000, 232000, 237000, 243000, 249000, 255000, 261000, 267000, 274000, 280000, 287000, 294000, 301000, 309000, 316000, 324000, 332000, 340000, 348000, 357000, 365000, 374000, 383000, 392000, 402000, 412000, 422000, 432000, 442000, 453000, 464000, 475000, 487000, 499000, 511000, 523000, 536000, 549000, 562000, 576000, 590000, 604000, 619000, 634000, 649000, 665000, 681000, 698000, 715000, 732000, 750000, 768000, 787000, 806000, 825000, 845000, 866000, 887000, 909000, 931000, 953000, 976000, 1000000, 1020000, 1050000, 1070000, 1100000, 1130000, 1150000, 1180000, 1210000, 1240000, 1270000, 1300000, 1330000, 1370000, 1400000, 1430000, 1470000, 1500000, 1540000, 1580000, 1620000, 1650000, 1690000, 1740000, 1780000, 1820000, 1870000, 1910000, 1960000, 2000000, 2050000, 2100000, 2150000, 2210000, 2260000, 2320000, 2370000, 2430000, 2490000, 2550000, 2610000, 2670000, 2740000, 2800000, 2870000, 2940000, 3010000, 3090000, 3160000, 3240000, 3320000, 3400000, 3480000, 3570000, 3650000, 3740000, 3830000, 3920000, 4020000, 4120000, 4220000, 4320000, 4420000, 4530000, 4640000, 4750000, 4870000, 4990000, 5110000, 5230000, 5360000, 5490000, 5620000, 5760000, 5900000, 6040000, 6190000, 6340000, 6490000, 6650000, 6810000, 6980000, 7150000, 7320000, 7500000, 7680000, 7870000, 8060000, 8250000, 8450000, 8660000, 8870000, 9090000, 9310000, 9530000, 9760000, 10000000, 10200000, 10500000, 10700000, 11000000, 11300000, 11500000, 11800000, 12100000, 12400000, 12700000, 13000000, 13300000, 13700000, 14000000, 14300000, 14700000, 15000000, 15400000, 15800000, 16200000, 16500000, 16900000, 17400000, 17800000, 18200000, 18700000, 19100000, 19600000, 20000000, 20500000, 21000000, 21500000, 22100000, 22600000, 23200000, 23700000, 24300000, 24900000, 25500000, 26100000, 26700000, 27400000, 28000000, 28700000, 29400000, 30100000, 30900000, 31600000, 32400000, 33200000, 34000000, 34800000, 35700000, 36500000, 37400000, 38300000, 39200000, 40200000, 41200000, 42200000, 43200000, 44200000, 45300000, 46400000, 47500000, 48700000, 49900000, 51100000, 52300000, 53600000, 54900000, 56200000, 57600000, 59000000, 60400000, 61900000, 63400000, 64900000, 66500000, 68100000, 69800000, 71500000, 73200000, 75000000, 76800000, 78700000, 80600000, 82500000, 84500000, 86600000, 88700000, 90900000, 93100000, 95300000, 97600000, 100000000);
   c_res = 0
   r_res = 0
   min_diff = 1
   decade = 1
   seed_decade = 1
   freq = parseFloat(document.theForm.freq.value)
   freq_entered = freq
   q = parseFloat(document.theForm.q.value)
   seed = parseFloat(document.theForm.seed.value)
   if (freq >= 100000000)
   {
      alert ("Frequency must be < 100 MHz!")
   }
   else if (freq >= 10000000 && freq < 100000000)
   {
      freq = freq / 100000000
      decade = decade * 1000000000
   }
   else if (freq >= 1000000 && freq < 10000000)
   {
      freq = freq / 10000000
      decade = decade * 100000000
   }
   else if (freq >= 100000 && freq < 1000000)
   {
      freq = freq / 1000000
      decade = decade * 10000000
   }
   else if (freq >= 10000 && freq < 100000)
   {
      freq = freq / 100000
      decade = decade * 1000000
   }
   else if (freq >= 1000 && freq < 10000)
   {
      freq = freq / 10000
      decade = decade * 100000
   }
   else if (freq >= 100 && freq < 1000)
   {
      freq = freq / 1000
      decade = decade * 10000
   }
   else if (freq >= 10 && freq < 100)
   {
      freq = freq / 100
      decade = decade * 1000
   }
   else if (freq >= 1 && freq < 10)
   {
      freq = freq / 10
      decade = decade * 100
   }
   else if (freq >= .1 && freq < 1)
   {
      decade = decade * 10
   }
   else if (freq >= .01 && freq < .1)
   {
      freq = freq * 10
      decade = decade * 1
   }
   else if (freq >= .001 && freq < .01)
   {
      freq = freq * 100
      decade = decade * .1
   }
   else alert("Frequency must be >= .001")
   for (i = 0 ; i < res.length ; i ++ )
   {
      for (j = 0 ; j < cap.length ; j ++ )
      {
         res_freq = 1 / (2 * Math.PI * res[i] * cap[j])
         if (res_freq < .01) res_freq = res_freq * 10
         if (res_freq < .1)  res_freq = res_freq * 10
         diff = Math.abs(freq - res_freq)
         if (diff <= min_diff)
         {
            min_diff = diff
            c_res = cap[j]
            r_res = res[i]
         }
      }
   
      real_freq = 1 / (2 * Math.PI * c_res * r_res / decade)
      if (freq_entered / real_freq > 90) decade = decade * 100
      if (freq_entered / real_freq > 9) decade = decade * 10
      if (real_freq / freq_entered > 9) decade = decade * .1
      decadeseed = (decade * seed) / 1000000000000
      document.theForm.c0.value = c_res / decadeseed
      document.theForm.r0.value = r_res * seed
   }
   q_factor = (2 * q) - 1
   rq2 = (r_res * seed) / q_factor
   rq1 = r_res * seed * q_factor
   rq2_low = 0
   rq2_high = 0
   rq1_low = 0
   rq1_high = 0
   for (k = 0 ; k < rq.length ; k ++ )
   {
      if (rq2 >= rq[k] && rq2 <= rq[k + 1])
      {
         rq2_low = rq[k]
         rq2_high = rq[k + 1]
      }
      if (rq1 >= rq[k] && rq1 <= rq[k + 1])
      {
         rq1_low = rq[k]
         rq1_high = rq[k + 1]
      }
   }
   rq2_high_diff = rq2_high - rq2
   rq2_low_diff = rq2 - rq2_low
   if (rq2_low_diff < rq2_high_diff)
   {
      rq2_final = rq2_low
   }
   else
   {
      rq2_final = rq2_high
   }
   rq1_high_diff = rq1_high - rq1
   rq1_low_diff = rq1 - rq1_low
   if (rq1_low_diff < rq1_high_diff)
   {
      rq1_final = rq1_low
   }
   else
   {
      rq1_final = rq1_high
   }
   document.theForm.rq2_final.value = rq2_final
   document.theForm.rq1_final.value = rq1_final
}
function clear1()
{
   document.theForm.c0.value = ""
   document.theForm.r0.value = ""
}
</SCRIPT>
</HEAD>
<BODY bgcolor="White">
<FONT face="arial">
<h1>Band Pass Filter Calculator</h1>


<FORM name="theForm">
<TABLE border="0"><TR><TD>
<TABLE TABLE cellspacing="0" cellpadding="1" border="0" bgcolor="#ccffcc"><TR><TD>
<TABLE cellspacing="0" cellpadding="3" border="0">
<TR>
   <TD colspan="2" align="right"><B>Enter Desired Center Frequency (Hz): </B></TD>
   <TD><INPUT name="freq" value="15000"></TD>
</TR>
<TR>
   <TD colspan="2" align="right"><B>Enter Desired Q (and Gain V/V): </B></TD>
   <TD><INPUT name="q" value="10"></TD>
</TR>
<TR>
   <TD colspan="2" align="right"><B>Select Resistor Sequence: </B></TD>
   <TD>
       <SELECT name="resseq">
          <OPTION value="96">E96</OPTION>
          <OPTION value="24">E24</OPTION>
       </SELECT>
   </TD>
</TR>
<TR>
   <TD colspan="2" align="right"><B>Select Capacitor Sequence: </B></TD>
   <TD>
       <SELECT name="capseq">
          <OPTION value="24">E24</OPTION>
          <OPTION value="12">E12</OPTION>
          <OPTION value="6">E6</OPTION>
       </SELECT>
   </TD>
</TR>
<TR>
   <TD colspan="2" align="right"><B>Select Resistor Scale (Ohms): </B></TD>
   <TD>
      <SELECT name="seed">
         <OPTION value="1">1</OPTION>
         <OPTION value="10">10</OPTION>
         <OPTION value="100">100</OPTION>
         <OPTION selected="" value="1000">1000</OPTION>
         <OPTION value="10000">10000</OPTION>
         <OPTION value="100000">100000</OPTION>
         <OPTION value="1000000">1000000</OPTION>
      </SELECT>
   </TD>
</TR>
<TR>
   <TD>&nbsp;</TD>
   <TD>&nbsp;</TD>
   <TD><INPUT type="button" value="Calculate" onclick="calculate1()"></TD>
</TR>
<TR>
   <TD><B>C1, C2 (pF)</B></TD>
   <TD><B>Ro (Ohms)</B></TD>
</TR>
<TR>
   <TD><INPUT name="c0" style="background: #ccffcc; border=0"></TD>
   <TD><INPUT name="r0" style="background: #ccffcc; border=0"></TD>
</TR>
<TR>
   <TD><B>Rq2 (Ohms)</B></TD>
   <TD><B>Rq1 (Ohms)</B></TD>
</TR>
<TR>
   <TD><INPUT name="rq2_final" style="background: #ccffcc; border=0"></TD>
   <TD><INPUT name="rq1_final" style="background: #ccffcc; border=0"></TD>
</TR>
</TABLE>
</TD></TR></TABLE>
<td><img src="bpf_adj.gif" tppabs="http://booksite.elsevier.com/9780123914958/content/Band_Pass_Filter_Calculator/bpf_adj.gif"></td></tr></table>
</FORM>
<p>The Q and gain are linked together - adjusting one affects the other.  RQ1 and RQ2 resistors are adjusted proportionally.  To increase the gain and Q, multiply Ro by a factor to get RQ1, and divide Ro by the same factor to get RQ2.  The responses below were obtained for various values of Q and gain:
<p><img src="bpf_adj_response.gif" tppabs="http://booksite.elsevier.com/9780123914958/content/Band_Pass_Filter_Calculator/bpf_adj_response.gif">
<h2>Notes:</h2>
<ul>
<li>Practical limits are a Q of about 50 on the high end, and 1 on the low end.</li>
<li>The open loop gain of the op amp selected must be at least 40 dB greater than the gain of the op amp at the resonant frequency.</li>
<li>The input impedance of the op amp becomes important as RQ1 increases in value, for large values of Q you may need an FET input type op amp.  You can combat this by scaling the R's and C's, but remember you need to use an NPO type capacitor for stability.</li>
</ul>
</FONT>
</BODY>
</HTML>
